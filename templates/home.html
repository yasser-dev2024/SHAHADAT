<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø´Ù‡Ø§Ø¯Ø§ØªÙƒ Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ</title>
  <style>
    body {
      margin: 0;
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(180deg, #fff0f6 0%, #fce9ff 50%, #e9f5ff 100%);
      background-attachment: fixed;
      animation: bgMove 10s ease-in-out infinite alternate;
    }

    @keyframes bgMove {
      from { background-position: top left; }
      to { background-position: bottom right; }
    }

    .container {
      padding: 30px;
      max-width: 1200px;
      margin: auto;
    }

    h2 {
      text-align: center;
      color: #ff6f91;
      margin-bottom: 30px;
      font-size: 30px;
      letter-spacing: 1px;
    }

    /* ğŸŒ¸ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª */
    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 35px;
    }

    .category-buttons button {
      background: linear-gradient(145deg, #ffd6e0, #ffe9f1);
      border: none;
      padding: 12px 24px;
      border-radius: 16px;
      color: #333;
      font-weight: 600;
      font-size: 17px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 5px 10px rgba(255, 111, 145, 0.2);
      overflow: hidden;
    }

    .category-buttons button::before {
      content: "";
      position: absolute;
      top: 0;
      left: -75%;
      width: 50%;
      height: 100%;
      background: linear-gradient(120deg, rgba(255,255,255,0.3), rgba(255,255,255,0));
      transform: skewX(-25deg);
      transition: 0.6s;
    }

    .category-buttons button:hover::before { left: 125%; }

    .category-buttons button:hover {
      background: linear-gradient(145deg, #ff8cb2, #ffa7c4);
      color: white;
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 6px 18px rgba(255, 111, 145, 0.35);
    }

    /* âœ¨ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 25px;
      justify-items: center;
    }

    .card {
      width: 100%;
      max-width: 260px;
      background: white;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 2px solid transparent;
      background-image: linear-gradient(white, white),
                        linear-gradient(45deg, #ff6f91, #ffb3c6, #ffd6e0, #ff6f91);
      background-origin: border-box;
      background-clip: content-box, border-box;
      opacity: 0;
      transform: translateY(40px);
      animation: fadeSlideIn 0.6s forwards;
    }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(255, 111, 145, 0.25);
    }

    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .card:hover img { transform: scale(1.05); }

    .card h3 {
      margin: 0;
      padding: 15px;
      text-align: center;
      font-size: 18px;
      color: #444;
      font-weight: 600;
      background: #fff9fb;
    }

    .preview {
      margin: 40px auto;
      max-width: 900px;
      position: relative;
      display: none;
      text-align: center;
    }

    .preview img { width: 100%; border-radius: 12px; }

    .editable {
      position: absolute;
      cursor: grab;
      font-family: 'Cairo', sans-serif;
      font-weight: bold;
      color: #000;
      user-select: none;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .lock-badge {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-30deg);
      background: rgba(255, 0, 0, 0.35);
      color: white;
      font-size: 22px;
      font-weight: bold;
      padding: 18px 40px;
      border-radius: 10px;
      z-index: 20;
      user-select: none;
      pointer-events: none;
      white-space: nowrap;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }

    #customLogo {
      position: absolute;
      top: 30px;
      right: 30px;
      width: 120px;
      opacity: 0.9;
      display: none;
      z-index: 10;
      cursor: grab;
      border: none;
    }

    #resizeHandle {
      position: absolute;
      width: 18px;
      height: 18px;
      bottom: -10px;
      right: -10px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 4px;
      cursor: se-resize;
      display: none;
      z-index: 15;
    }

    .form-area {
      text-align: center;
      margin: 30px 0;
      display: none;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .form-area input, .form-area select, .form-area button {
      margin: 6px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 15px;
    }

    .form-area button {
      background: #ff6f91;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    .form-area button:hover { background: #ff3b6f; }

    @media (max-width: 768px) {
      h2 { font-size: 24px; }
      .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    }
  </style>
</head>
<body>

{% include "header.html" %}

<div class="container">
  <h2>ğŸŒ¸ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ğŸŒ¸</h2>

  <div class="category-buttons">
    {% for category in categories %}
      <button onclick="toggleCategory('{{ category.id }}')" id="btn-{{ category.id }}">ğŸ“ {{ category.name }}</button>
    {% endfor %}
  </div>

  {% for category in categories %}
    <div id="category-{{ category.id }}" class="grid" style="display:none;">
      {% for template in category.templates.all %}
      <div class="card" onclick="selectCert('{{ template.background.url }}')">
        <img src="{{ template.background.url }}" alt="{{ template.title }}">
        <h3>{{ template.title }}</h3>
      </div>
      {% empty %}
      <p style="text-align:center; grid-column:1/-1; font-size:18px; color:#444;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ ğŸŒ·</p>
      {% endfor %}
    </div>
  {% endfor %}

  <div id="preview" class="preview">
    <img id="previewImg" src="" alt="Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©">
    <img id="customLogo" src="">
    <div id="resizeHandle"></div>
    <div id="studentName" class="editable" style="top:38%;left:25%;">[Ø§Ù„Ø§Ø³Ù…]</div>
    <div id="certificateText" class="editable" style="top:47%;left:15%;width:70%;text-align:center;">[Ù†Øµ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©]</div>
    <div id="schoolName" class="editable" style="top:65%;left:25%;">[Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø´Ø£Ø©]</div>
    <div id="positionTitle" class="editable" style="top:78%;left:25%;">[ØµÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹]</div>
    <div id="managerName" class="editable" style="top:83%;left:25%;">[Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹]</div>
    <div id="lockBadge" class="lock-badge">ğŸ”’ Ø§Ø·Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¢Ù† Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªÙ†Ø²ÙŠÙ„</div>
  </div>

  <div id="formInputs" class="form-area">
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" oninput="updateText('studentName', this.value)">
    <input type="text" placeholder="Ù†Øµ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©" oninput="updateText('certificateText', this.value)" style="width:300px;">
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø´Ø£Ø©" oninput="updateText('schoolName', this.value)">
    <input type="text" placeholder="ØµÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹" oninput="updateText('positionTitle', this.value)">
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹" oninput="updateText('managerName', this.value)">
    <br>
    <label>ğŸ¨ Ø§Ù„Ù„ÙˆÙ†:</label> <input type="color" id="textColor" value="#000000">
    <label>ğŸ”  Ø§Ù„Ø­Ø¬Ù…:</label> <input type="number" id="fontSize" value="22" min="10" max="60">
    <label>ğŸ–‹ï¸ Ø§Ù„Ø®Ø·:</label>
    <select id="fontFamily">
      <option value="Cairo">Cairo</option>
      <option value="Tahoma">Tahoma</option>
      <option value="Arial">Arial</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Amiri">Amiri</option>
    </select>
    <br><br>
    <label>ğŸ–¼ï¸ Ø£Ø¶Ù Ø´Ø¹Ø§Ø±Ùƒ:</label>
    <input type="file" id="logoUploader" accept="image/*">
    <label>ğŸŒ«ï¸ Ø§Ù„Ø´ÙØ§ÙÙŠØ©:</label>
    <input type="range" id="logoOpacity" min="0.1" max="1" step="0.1" value="0.9">
    <br><br>
    <button onclick="requestCode()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© / ØªÙ†Ø²ÙŠÙ„</button>
  </div>
</div>

{% include "footer.html" %}

<script>
function toggleCategory(id) {
  document.querySelectorAll('[id^="category-"]').forEach(div => div.style.display = 'none');
  document.querySelectorAll('.category-buttons button').forEach(btn => btn.classList.remove('active'));
  const selected = document.getElementById(`category-${id}`);
  selected.style.display = 'grid';
  document.getElementById(`btn-${id}`).classList.add('active');
}

function selectCert(imgUrl) {
  document.getElementById('preview').style.display = 'block';
  document.getElementById('formInputs').style.display = 'block';
  document.getElementById('previewImg').src = imgUrl;
}

function updateText(target, value) {
  document.getElementById(target).innerText = value || `[${target}]`;
}

document.getElementById('textColor').oninput = function() {
  document.querySelectorAll('.editable').forEach(el => el.style.color = this.value);
};
document.getElementById('fontSize').oninput = function() {
  document.querySelectorAll('.editable').forEach(el => el.style.fontSize = this.value + 'px');
};
document.getElementById('fontFamily').onchange = function() {
  document.querySelectorAll('.editable').forEach(el => el.style.fontFamily = this.value);
};

/* âœ… Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ */
async function requestCode() {
  const whatsappNumber = "966501894192"; // Ø¶Ø¹ Ø±Ù‚Ù…Ùƒ Ù‡Ù†Ø§ Ø¨Ø¯ÙˆÙ† +
  let code = prompt("ğŸ”‘ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø²ÙŠÙ„:");

  if (!code) {
    if (confirm("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø².\nÙ‡Ù„ ØªØ±ØºØ¨ Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø·Ù„Ø¨ Ø§Ù„Ø±Ù…Ø²ØŸ")) {
      window.open(`https://wa.me/${whatsappNumber}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø´Ù‡Ø§Ø¯Ø§Øª.`, "_blank");
    }
    return;
  }

  try {
    const response = await fetch(`/commerce/validate-code/${code}/`);
    const data = await response.json();

    if (data.valid) {
      document.getElementById('lockBadge').style.display = 'none';
      alert(`âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©.\nğŸ“„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${data.remaining} Ø´Ù‡Ø§Ø¯Ø©`);
    } else if (data.reason === 'limit_reached') {
      alert("âš ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø². Ø§Ø·Ù„Ø¨ Ø±Ù…Ø²Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.");
      window.open(`https://wa.me/${whatsappNumber}?text=Ø±Ù…Ø²ÙŠ Ø§Ù†ØªÙ‡Ù‰ ÙˆØ£Ø­ØªØ§Ø¬ Ø±Ù…Ø²Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ù„Ù„Ø´Ù‡Ø§Ø¯Ø§Øª.`, "_blank");
    } else {
      alert("âŒ Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
      window.open(`https://wa.me/${whatsappNumber}?text=Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ù„Ø¯ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­ØŒ Ø£Ø±Ø¬Ùˆ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.`, "_blank");
    }
  } catch {
    alert("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
  }
}
</script>

</body>
</html>
